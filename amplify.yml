version: 1
applications:
  - appRoot: apps/web
    frontend:
      buildPath: /
      phases:
        preBuild:
          commands:
            - rm -rf apps/web/node_modules
            - rm -rf apps/web/.next
            - npm install -g pnpm
            - pnpm install --frozen-lockfile
        build:
          commands:
            - touch apps/web/.env.production
            - echo "BRAZE_INSTANCE_URL=$BRAZE_INSTANCE_URL" >> apps/web/.env.production
            - echo "BRAZE_API_KEY=$BRAZE_API_KEY" >> apps/web/.env.production
            - echo "BRAZE_GENERAL_WAITLIST_GROUP_ID=$BRAZE_GENERAL_WAITLIST_GROUP_ID" >> apps/web/.env.production
            - echo "BRAZE_DEVELOPERS_WAITLIST_GROUP_ID=$BRAZE_DEVELOPERS_WAITLIST_GROUP_ID" >> apps/web/.env.production
            - echo "MULTIPLIER_JWT_SECRET=$MULTIPLIER_JWT_SECRET" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_BOT_GITHUB_APP_ID=$INK_APP_SUBMISSION_BOT_GITHUB_APP_ID" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_BOT_GITHUB_INSTALLATION_ID=$INK_APP_SUBMISSION_BOT_GITHUB_INSTALLATION_ID" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_BOT_GITHUB_PRIVATE_KEY=$INK_APP_SUBMISSION_BOT_GITHUB_PRIVATE_KEY" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_SLACK_BOT_TOKEN=$INK_APP_SUBMISSION_SLACK_BOT_TOKEN" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_SLACK_NOTIFICATION_CHANNEL=$INK_APP_SUBMISSION_SLACK_NOTIFICATION_CHANNEL" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_TARGET_BRANCH=$INK_APP_SUBMISSION_TARGET_BRANCH" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_TARGET_ORG=$INK_APP_SUBMISSION_TARGET_ORG" >> apps/web/.env.production
            - echo "INK_APP_SUBMISSION_TARGET_REPO=$INK_APP_SUBMISSION_TARGET_REPO" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_WC_PROJECT_ID=$NEXT_PUBLIC_WC_PROJECT_ID" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_FAUCET_API_URL=$NEXT_PUBLIC_FAUCET_API_URL" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_GELATO_BRIDGE_URL=$NEXT_PUBLIC_GELATO_BRIDGE_URL" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_SENTRY_DSN=$NEXT_PUBLIC_SENTRY_DSN" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_GTM_ID=$NEXT_PUBLIC_GTM_ID" >> apps/web/.env.production
            - echo "NEXT_PUBLIC_SEGMENT_WRITE_KEY=$NEXT_PUBLIC_SEGMENT_WRITE_KEY" >> apps/web/.env.production
            - echo "HCAPTCHA_SECRET=$HCAPTCHA_SECRET" >> apps/web/.env.production
            - pnpm run build
      artifacts:
        baseDirectory: apps/web/.next
        files:
          - "**/*"
      cache:
        paths:
          - node_modules/**/*
          - apps/web/.next/cache/**/*
